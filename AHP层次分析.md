# 层次分析法（AHP）
层次分析法（Analytic Hierarchy Process）由美国运筹学家萨蒂在20世纪70年代提出，是一种将 半定性、半定量问题 转化为定量问题解决的<strong>决策方法</strong>。

AHP将各种因素层次化，并逐层比较多种关联因素，为分析和预测事物发展提供可比较的定量依据。

AHP适用于那些难以完全用定量进行分析的复杂问题，因此在资源分配、选优排序、政策分析、冲突解决以及决策预报等领域得到广泛的应用。

AHP的应用场景归纳如下：

* 评价、评判类的题目。
* 资源分配和决策类的题目。
* 一些优化问题，尤其是多目标优化问题。

## 层次结构模型
层次结构模型分为三层：

  * 最高层： 目的、要解决的问题
  * 中间层： 考虑的因素、决策的准则、主因素，可包含若干层
  * 最低层： 解决问题的各种措施、方案，或为中间层的子因素

两层之间，较高层称为目标层，较低层称为因素层。

要得出最优方案，就需要确定各方案的定量的权重大小，权重越大，则方案越好。为确定最终方案（最底层）对于目的（最高层）的影响的权重大小，需要逐层构建判断矩阵，进行分析。

### 判断矩阵的构建
判断矩阵是比较各层次各因素权重大小定量化的结果。一般采用Santy的1-9标度法。
通过每两个因素之间的比较，可以构建一个正反矩阵。
并且$\lambda_{max}$对应的特征向量$\omega$经过归一化后，就是同一层次各元素相对于上一层的权重

### 判断矩阵的检验
判断矩阵是否有效，是解决问题时十分容易遇到的。而我们采用一致性去判断 判断矩阵 的有效性。主要就是通过一致性比率C.R进行判断。

一致性比率C.R，即一致性指标C.I和同阶平均随机一致性指数R.I的比值。由一致性矩阵的特征可以知道在一致性矩阵中，$\lambda_{max}=n$，因此，若判断矩阵的$\lambda_{max}$越接近于$n$，则判断矩阵的一致性越接近完全一致。所以用一致性指标$C.R=\frac{\lambda_{max}}{n-1}$来表示。

但由于不同阶数的判断矩阵的一致性指标之间难以比较，为了统一比较的标准，引入了平均随机一致性指数R.I。该指数通过随机方法构造判断矩阵，经过500次以上的重复计算，求出一致性指标，并加以平均而得到的。

一般认为$C.R<0.1$时，判断矩阵符合一致性标准。
### 层次总排列
最终结果需要综合各个层次的权重进行计算，即称为层次总排列。
层次总排列权重的计算方法即为，最底层的方案在中间层的每一个目标的权重与该目标对于最高层的权重的积的和。

层次总排列的一致性检验为$C.R=\frac{b_1*C.I_1+...+b_m*C.I_m}{b_1*R.I_1+...+b_m*R.I_m}$。

## AHP权重计算MATLAB代码
```
%AHP权重计算程序
%数据读入
function w = AHP(A)
%%一致性检验
[n,n]=size(A);
[v,d]=eig(A);%返回特征值的对角矩阵 D 和矩阵 V，其列是对应的右特征向量，使得 A*V = V*D。
r=d(1,1);%最大特征值
CI=(r-n)/(n-1);
RI=[0 0 0.58 0.90 1.12 1.24 1.32 1.41 1.45 1.49 1.52 1.54 1.56 1.58 1.59];
CR=CI/RI(n);
if CR<0.10
    CR_Result = '通过';
else
    CR_Result = '不通过';
end
%%权向量计算
w=v(:,1)/sum(v(:,1));
w=w';
disp('判断矩阵权向量计算报告');
disp(['一致性指标:',num2str(CI)]);
disp(['一致性比例:',num2str(CR)]);
disp(['一致性检验结果:',CR_Result]);
disp(['特征值:',num2str(r)]);
disp(['权向量:',num2str(w)]);
```